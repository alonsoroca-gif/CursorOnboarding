#!/bin/bash
# Ensure docs + root are synced before push so the live site always updates.
# Install: cp scripts/pre-push-github-pages .git/hooks/pre-push && chmod +x .git/hooks/pre-push
set -e
ROOT="$(git rev-parse --show-toplevel)"
pushed_main=0
while read -r local_ref local_sha remote_ref remote_sha; do
  [[ "$remote_ref" == refs/heads/main ]] && pushed_main=1
done
[[ $pushed_main -eq 0 ]] && exit 0
cd "$ROOT"
[[ -x "$ROOT/sync-docs-for-pages.sh" ]] || exit 0
"$ROOT/sync-docs-for-pages.sh" >/dev/null 2>&1
if ! git diff --quiet -- "docs/" "index.html" "onboarding-pm.html" "onboarding-pm.js" "setup-chat.html" "setup-chat.js" "cursor-rules.html" "cursor-rules.js" "screenshots/" ".nojekyll" 2>/dev/null; then
  echo ""
  echo "⚠️  Sync updated files. Run ./push again to commit and push so the live site gets your changes."
  echo ""
  exit 1
fi
exit 0
